<!DOCTYPE html>
<html lang="hr">

<head>
    <meta charset="UTF-8">
    <title>Magnolya Salon</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #ffecfa;
            color: black;
        }

        .accent-bg {
            background-color: #8c5778 !important;
            color: black !important;
        }

        .table thead {
            background-color: #6c3f5a;
            color: black;
        }

        .form-control,
        .form-select {
            background-color: #fff;
            color: black;
        }

        button {
            background-color: #8c5778;
            color: black;
            font-weight: bold;
        }

        button:hover {
            background-color: #6c3f5a;
            color: black;
        }
    </style>
</head>

<body class="p-4">
    <div class="container">

        <h1 class="mb-4">Dodaj rezervaciju</h1>
        <form id="rezervacijaForm" class="p-3 accent-bg rounded mb-5">
            <div class="mb-3">
                <label class="form-label">Prezime:</label>
                <input type="text" name="prezime" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Kontakt:</label>
                <input type="text" name="kontakt" class="form-control" required>
            </div>
            <div class="row mb-3">
                <div class="col">
                    <label class="form-label">Datum:</label>
                    <input type="date" name="datum" class="form-control" required>
                </div>
                <div class="col">
                    <label class="form-label">Vrijeme:</label>
                    <input type="time" name="vrijeme" class="form-control" required>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Usluga:</label>
                <select name="usluga" id="uslugaSelect" class="form-select" required></select>
            </div>
            <div class="mb-3">
                <label class="form-label">Djelatnik:</label>
                <input type="text" name="djelatnik" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Napomena:</label>
                <textarea name="napomena" class="form-control"></textarea>
            </div>
            <button type="submit" class="btn btn-primary w-100">Dodaj rezervaciju</button>
        </form>

        <h2>Dodaj uslugu</h2>
        <form id="uslugaForm" class="p-3 accent-bg rounded mb-5">
            <div class="mb-3">
                <label class="form-label">Naziv usluge:</label>
                <input type="text" name="naziv" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Vrsta usluge:</label>
                <input type="text" name="vrsta" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Trajanje (min):</label>
                <input type="number" name="trajanje" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Cijena (€):</label>
                <input type="number" name="cijena" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Dodaj uslugu</button>
        </form>

        <h1 class="mb-4">Rezervacije</h1>
        <div class="table-responsive">
            <table id="rezervacijeTable" class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Prezime</th>
                        <th>Kontakt</th>
                        <th>Datum</th>
                        <th>Vrijeme</th>
                        <th>Usluga</th>
                        <th>Djelatnik</th>
                        <th>Napomena</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        async function loadUsluge() {
            const res = await fetch("/usluge");
            const data = await res.json();
            const select = document.getElementById("uslugaSelect");
            select.innerHTML = "";
            data.forEach(u => {
                const opt = document.createElement("option");
                opt.value = u.id_usluge;
                opt.textContent = `${u.naziv_usluge} (${u.cijena}€)`;
                select.appendChild(opt);
            });
        }

        async function loadRezervacije() {
            const res = await fetch("/rezervacije");
            const data = await res.json();
            const tbody = document.querySelector("#rezervacijeTable tbody");
            tbody.innerHTML = "";
            data.forEach(rez => {
                const row = document.createElement("tr");
                row.innerHTML = `
      <td>${rez.id_rezervacije}</td>
      <td>${rez.prezime_osobe}</td>
      <td>${rez.kontakt}</td>
      <td>${rez.datum_termina.split("T")[0]}</td>
      <td>${rez.vrijeme_termina.split("T")[1].slice(0, 5)}</td>
      <td>${rez.usluga ? rez.usluga.naziv_usluge : "N/A"}</td>
      <td>${rez.djelatnik}</td>
      <td>${rez.napomena || ""}</td>
    `;
                tbody.appendChild(row);
            });
        }

        document.getElementById("rezervacijaForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            const f = new FormData(this);
            const payload = {
                prezime_osobe: f.get("prezime"),
                kontakt: f.get("kontakt"),
                datum_termina: f.get("datum"),
                vrijeme_termina: f.get("vrijeme"),
                djelatnik: f.get("djelatnik"),
                napomena: f.get("napomena"),
                id_usluge: parseInt(f.get("usluga"))
            };
            const res = await fetch("/rezervacije", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
            if (res.ok) { this.reset(); loadRezervacije(); } else { alert("Greška!"); }
        });

        document.getElementById("uslugaForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            const f = new FormData(this);
            const payload = {
                naziv_usluge: f.get("naziv"),
                vrsta_usluge: f.get("vrsta"),
                trajanje: parseInt(f.get("trajanje")),
                cijena: parseInt(f.get("cijena"))
            };
            const res = await fetch("/usluge", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
            if (res.ok) { this.reset(); loadUsluge(); alert("Usluga dodana!"); } else { alert("Greška!"); }
        });

        loadUsluge();
        loadRezervacije();
    </script>